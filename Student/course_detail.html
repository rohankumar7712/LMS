<!-- course_detail.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Course Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f6f9;
    }
    .sidebar {
      height: 100vh;
      background-color: #2A5C88;
      color: white;
      padding: 1rem;
    }
    .sidebar h4 {
      margin-bottom: 1rem;
    }
    .sidebar a {
      display: block;
      padding: 0.5rem 1rem;
      color: white;
      text-decoration: none;
      margin-bottom: 0.25rem;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.1);
    }
    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .main-content {
      padding: 2rem;
    }
    .week-card {
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: white;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 sidebar">
      <h4 id="courseName">Loading...</h4>
      <div id="weeksMenu"></div>
      <a href="our_course.html" style="background-color:#1f4568;">Back to Courses</a>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 main-content">
      <h3>Course Weeks</h3>
      <div id="weekContent">
        <p>Select a week from the left menu to see details.</p>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAPFlx9gVV6Q0a8Bwv4Et0OfytgIWApQng",
    authDomain: "clms-3b972.firebaseapp.com",
    projectId: "clms-3b972",
    storageBucket: "clms-3b972.appspot.com",
    messagingSenderId: "213199198013",
    appId: "1:213199198013:web:4a576ce4f4af68469b1754"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Get courseId from URL
  const params = new URLSearchParams(window.location.search);
  const courseId = params.get("courseId");

  if (!courseId) {
    alert("Invalid course ID.");
  }

  let courseSubjects = []; // store subjects from Firestore

async function loadCourseDetails() {
    const courseRef = doc(db, "courses", courseId);
    const courseSnap = await getDoc(courseRef);

    if (!courseSnap.exists()) {
        alert("Course not found!");
        return;
    }

    const course = courseSnap.data();
    document.getElementById("courseName").innerText = course.title;

    // store subjects globally
    courseSubjects = course.subjects || [];

    const weeksMenu = document.getElementById("weeksMenu");
    weeksMenu.innerHTML = "";

    if (!course.weeks || course.weeks < 1) {
        weeksMenu.innerHTML = "<p>No weeks available.</p>";
        return;
    }

    for (let i = 1; i <= course.weeks; i++) {
        const weekLink = document.createElement("a");
        weekLink.href = "#";
        weekLink.innerText = `Week ${i}`;
        weekLink.addEventListener("click", () => loadWeekContent(i));
        weeksMenu.appendChild(weekLink);
    }
}

function loadWeekContent(weekNumber) {
    const contentDiv = document.getElementById("weekContent");

    if (!courseSubjects.length) {
        contentDiv.innerHTML = `<p>No subjects found for this course.</p>`;
        return;
    }

    let cardsHTML = `<h4>Week ${weekNumber}</h4><div class="row">`;

    courseSubjects.forEach(subject => {
        cardsHTML += `
            <div class="col-md-4">
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${subject}</h5>
                        <p class="card-text">Week ${weekNumber} - ${subject}</p>
                        <a href="week_detail.html?courseId=${courseId}&week=${weekNumber}&subject=${encodeURIComponent(subject)}" 
                           class="btn btn-primary">Enter</a>
                    </div>
                </div>
            </div>
        `;
    });

    cardsHTML += `</div>`;
    contentDiv.innerHTML = cardsHTML;
}

  loadCourseDetails();
</script>
</body>
</html>
